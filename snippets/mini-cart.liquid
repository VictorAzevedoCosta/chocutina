<div id="mini-cart" class="mini-cart">
    {%- if cart.item_count != 0 -%}
        {% render 'upsellsDesktop' %}
    {% endif %}

    <form method="post" action="{{ routes.cart_url }}" aria-hidden="true"
          novalidate="novalidate" data-item-count="{{ cart.item_count }}">
        <input type="hidden" name="attributes[collection_products_per_page]" value="">
        <input type="hidden" name="attributes[collection_layout]" value="">
        <div class="justWrapper">

            {%- if cart.item_count == 0 -%}
                <div class="mini-cart__content mini-cart__content--empty">
                    <header class="drawer__header">
                        <p class="drawer__title heading">
                        </p>

                        <button type="button" class="drawer__close-button tap-area" onclick="closeCart()"
                                data-action="close" title="Close">
                            <svg focusable="false" width="14" height="14" class="icon icon--close   "
                                 viewBox="0 0 14 14">
                                <path d="M13 13L1 1M13 1L1 13" stroke="currentColor" stroke-width="1.3"
                                      fill="none"></path>
                            </svg>
                        </button>
                    </header>

                    <div class="mini-cart__empty-state">
                        {% if settings.icone_carrinho == 'bag' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"
                                 fill="{{ settings.heading_color }}" class="bi bi-bag-x" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M6.146 8.146a.5.5 0 0 1 .708 0L8 9.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 10l1.147 1.146a.5.5 0 0 1-.708.708L8 10.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 10 6.146 8.854a.5.5 0 0 1 0-.708z"></path>
                                <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"></path>
                            </svg>

                            <p class="empty-state__heading heading h1">{{ 'cart.general.empty_bag' | t }}</p>
                        {% else %}
                            <div class="empty-state__icon">
                                {%- render 'icon', icon: 'big-cart' -%}
                            </div>

                            <p class="empty-state__heading heading h1">{{ 'cart.general.empty' | t }}</p>
                        {% endif %}
                    </div>

                    <a href="{{ settings.cart_empty_button_link }}"
                       class="button button--primary button--full">{{ 'cart.general.empty_button' | t }}</a>
                </div>
            {%- else -%}
                <header class="drawer__header">
                    <p class="drawer__title heading">
                        {% if settings.icone_carrinho == 'bag' %}
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-bag-dash-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                      d="M10.5 3.5a2.5 2.5 0 0 0-5 0V4h5v-.5zm1 0V4H15v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4h3.5v-.5a3.5 3.5 0 1 1 7 0zM6 9.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1H6z"></path>
                            </svg>
                        {% else %}
                            {%- render 'icon', icon: 'cart' -%}
                        {% endif %}

                        <span style="padding-top: 5px;">{{ cart.item_count }} {{ cart.item_count | pluralize: 'item', 'itens' }}</span>
                    </p>

                    <button type="button" class="drawer__close-button tap-area" onclick="closeCart()"
                            data-action="close" title="Close">
                        <svg focusable="false" width="14" height="14" class="icon icon--close   "
                             viewBox="0 0 14 14">
                            <path d="M13 13L1 1M13 1L1 13" stroke="currentColor" stroke-width="1.3"
                                  fill="none"></path>
                        </svg>
                    </button>
                </header>

                <div class="mini-cart__inner">
                    <div class="mini-cart__content">
                        {%- if shipping_alert != blank -%}
                            <div class="mini-cart__alert-wrapper">
                                {{- shipping_alert -}}
                            </div>
                        {%- endif -%}

                        <div class="mini-cart__line-item-list">
                            {%- for line_item in cart.items -%}
                                <div class="mini-cart__line-item">
                                    <div class="mini-cart__image-wrapper">
                                        {%- if line_item.image.aspect_ratio < 1 -%}
                                            <div class="aspect-ratio aspect-ratio--square">
                                                <img src="{{ line_item.image | img_url: '180x' }}"
                                                     alt="{{ line_item.image.alt | escape }}">
                                            </div>
                                        {%- else -%}
                                            <div class="aspect-ratio"
                                                 style="padding-bottom: {{ 100.0 | divided_by: line_item.image.aspect_ratio }}%">
                                                <img src="{{ line_item.image | img_url: '180x' }}"
                                                     alt="{{ line_item.image.alt | escape }}">
                                            </div>
                                        {%- endif -%}
                                    </div>

                                    <div class="mini-cart__item-wrapper">
                                        <div class="mini-cart__product-info">
                                            {%- unless line_item.product.tags contains '__gift' -%}
                                                {%- if settings.show_vendor -%}
                                                    {%- assign vendor_handle = line_item.product.vendor | handle -%}
                                                    {%- assign collection_for_vendor = collections[vendor_handle] -%}

                                                    {%- unless collection_for_vendor.empty? -%}
                                                        <a class="mini-cart__product-vendor link"
                                                           href="{{ collection_for_vendor.url }}">{{ line_item.product.vendor }}</a>
                                                    {%- else -%}
                                                        <a class="mini-cart__product-vendor link"
                                                           href="{{ line_item.product.vendor | url_for_vendor }}">{{ line_item.product.vendor }}</a>
                                                    {%- endunless -%}
                                                {%- endif -%}
                                            {%- endunless -%}

                                            <a href="{{ line_item.url }}"
                                               class="mini-cart__product-title text--strong link">{{ line_item.title }}</a>

                                            {%- if line_item.selling_plan_allocation -%}
                                                <p class="mini-cart__plan-allocation">{{ line_item.selling_plan_allocation.selling_plan.name }}</p>
                                            {%- endif -%}

                                            {%- unless line_item.properties == blank -%}
                                                <ul class="mini-cart__property-list" role="list">
                                                    {%- for property in line_item.properties -%}
                                                        {%- assign first_character_in_key = property.first | truncate: 1, '' -%}

                                                        {%- if property.last == blank or first_character_in_key == '_' -%}
                                                            {%- continue -%}
                                                        {%- endif -%}

                                                        <li class="mini-cart__property">{{ property.first }}
                                                            : {{ property.last }}</li>
                                                    {%- endfor -%}
                                                </ul>
                                            {%- endunless -%}

                                            <div class="mini-cart__price-list">
                                                {%- if line_item.final_line_price < line_item.original_line_price -%}
                                                    <span class="price price--highlight">{{ line_item.final_line_price | money }}</span>
                                                    <span class="price price--compare">{{ line_item.original_line_price | money }}</span>
                                                {%- elsif line_item.variant.compare_at_price > line_item.variant.price -%}
                                                    <span class="price price--highlight">{{ line_item.final_line_price | money }}</span>
                                                    <span class="price price--compare">{{ line_item.variant.compare_at_price | times: line_item.quantity | money }}</span>
                                                {%- else -%}
                                                    <span class="price">{{ line_item.final_line_price | money }}</span>
                                                {%- endif -%}
                                            </div>

                                            {%- if line_item.unit_price_measurement -%}
                                                <div class="mini-cart__price-info">
                                                    <div class="unit-price-measurement">
                                                        <span class="unit-price-measurement__price">{{ line_item.unit_price | money }}</span>
                                                        <span class="unit-price-measurement__separator">/ </span>

                                                        {%- if line_item.unit_price_measurement.reference_value != 1 -%}
                                                            <span class="unit-price-measurement__reference-value">{{ line_item.unit_price_measurement.reference_value }}</span>
                                                        {%- endif -%}

                                                        <span class="unit-price-measurement__reference-unit">{{ line_item.unit_price_measurement.reference_unit }}</span>
                                                    </div>
                                                </div>
                                            {%- endif -%}

                                            {%- if line_item.line_level_discount_allocations != blank -%}
                                                <ul class="mini-cart__discount-list" role="list">
                                                    {%- for discount_allocation in line_item.line_level_discount_allocations -%}
                                                        <li class="mini-cart__discount">
                                                            {%- render 'icon', icon: 'sale' -%}{{ discount_allocation.discount_application.title }}
                                                            (-{{ discount_allocation.amount | money }})
                                                        </li>
                                                    {%- endfor -%}
                                                </ul>
                                            {%- endif -%}
                                        </div>

                                        {%- unless line_item.product.tags contains '__gift' -%}
                                            <div class="mini-cart__quantity">
                                                <div class="quantity-selector">
                                                    {%- assign allow_to_add_more = true -%}

                                                    {%- if line_item.variant.inventory_management and line_item.variant.inventory_policy == 'deny' and line_item.quantity == line_item.variant.inventory_quantity -%}
                                                        {%- assign allow_to_add_more = false -%}
                                                    {%- endif -%}

                                                    <button class="quantity-selector__button"
                                                            data-action="decrease-quantity"
                                                            data-quantity="{{ line_item.quantity | minus: 1 }}"
                                                            data-line-id="{{ line_item.key }}"
                                                            aria-label="{{ 'cart.items.decrease_quantity' | t }}"
                                                            title="{{ 'cart.items.decrease_quantity' | t }}">{% render 'icon', icon: 'minus' %}</button>
                                                    <input aria-label="{{ 'product.form.quantity' | t }}"
                                                           class="quantity-selector__value" pattern="[0-9]*"
                                                           data-current-value="{{ line_item.quantity }}"
                                                           data-line-id="{{ line_item.id }}"
                                                           value="{{ line_item.quantity }}"
                                                           size="{{ line_item.quantity | append: '' | size | at_least: 2 }}">
                                                    <button class="quantity-selector__button"
                                                            data-action="increase-quantity"
                                                            data-quantity="{{ line_item.quantity | plus: 1 }}"
                                                            data-line-id="{{ line_item.key }}"
                                                            {% if allow_to_add_more %}aria-label="{{ 'cart.items.increase_quantity' | t }}"
                                                            title="{{ 'cart.items.increase_quantity' | t }}"
                                                            {% else %}disabled="disabled"
                                                            aria-label="{{ 'cart.items.no_more_stock' | t }}"
                                                            data-tooltip="{{ 'cart.items.no_more_stock' | t }}"
                                                            data-tooltip-position="bottom-left"{% endif %}>{% render 'icon', icon: 'plus' %}</button>
                                                </div>
                                                <a href="{{ routes.cart_change_url }}?quantity=0&id={{ line_item.key }}"
                                                   data-action="decrease-quantity" data-quantity="0"
                                                   data-line-id="{{ line_item.key }}"
                                                   class="mini-cart__quantity-remove link">{{ 'cart.items.remove' | t }}</a>
                                            </div>
                                        {%- endunless -%}
                                    </div>
                                </div>
                            {%- endfor -%}
                        </div>
                    </div>
                </div>

                <div class="mini-cart__recap">
                    {%- if cart.item_count != 0 -%}
                        {% render 'upsellsMobile' %}
                    {% endif %}

                    {%- if cart.cart_level_discount_applications != blank -%}
                        {%- for discount_application in cart.cart_level_discount_applications -%}
                            <div class="mini-cart__recap-price-line mini-cart__recap-price-line--highlight text--pull">
                                <span>{{ discount_application.title }}</span>
                                <span>-{{ discount_application.total_allocated_amount | money }}</span>
                            </div>
                        {%- endfor -%}
                    {%- endif -%}

                    <div class="mini-cart__recap-price-line">
                        <span>{{ 'cart.general.total' | t }}</span>
                        <span>{{ cart.total_price | money }}</span>
                    </div>

                    <div class="cart-recap__price-line-payments">
                        {% if settings.show_installments %}
                            {% if settings.modo_parcelamento == 2 %}
                                {% assign taxa_parcela = settings.taxa_segunda_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 3 %}
                                {% assign taxa_parcela = settings.taxa_terceira_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 4 %}
                                {% assign taxa_parcela = settings.taxa_quarta_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 5 %}
                                {% assign taxa_parcela = settings.taxa_quinta_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 6 %}
                                {% assign taxa_parcela = settings.taxa_sexta_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 7 %}
                                {% assign taxa_parcela = settings.taxa_setima_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 8 %}
                                {% assign taxa_parcela = settings.taxa_oitava_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 9 %}
                                {% assign taxa_parcela = settings.taxa_nona_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 10 %}
                                {% assign taxa_parcela = settings.taxa_decima_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 11 %}
                                {% assign taxa_parcela = settings.taxa_decima_primeira_parcela | divided_by: 100 | plus: 1 %}
                            {% elsif settings.modo_parcelamento == 12 %}
                                {% assign taxa_parcela = settings.taxa_decima_segunda_parcela | divided_by: 100 | plus: 1 %}
                            {% endif %}

                            <span style="margin-bottom: 5px; display: block;">
                                ou em até <strong>{{ settings.modo_parcelamento }}x</strong> de <strong>{{ cart.total_price | times: taxa_parcela | divided_by: settings.modo_parcelamento | money }}</strong>{% if taxa_parcela == 1 %} sem juros{% endif %}
                            </span>
                        {% endif %}
                    </div>

                    {%- assign total_discount = 0 -%}

                    {%- for line_item in cart.items -%}
                        {%- if line_item.final_line_price < line_item.original_line_price -%}
                            {%- assign total_discount = total_discount | plus: line_item.total_discount -%}
                        {%- elsif line_item.variant.compare_at_price > line_item.variant.price -%}
                            {%- assign line_discount = line_item.variant.compare_at_price | minus: line_item.variant.price | times: line_item.quantity -%}
                            {%- assign total_discount = total_discount | plus: line_discount -%}
                        {%- endif -%}
                    {%- endfor -%}

                    <div style="margin-top: 10px;">
                        <a href="{{ routes.cart_url }}" class="button button--primary" style="width:100%;text-transform:uppercase;">
                            <span class="checkout-button__lock" style="position:absolute;
                                line-height: 24px;top:50%;margin-top:-12px;left: 20px;">
                                <svg focusable="false" width="20" height="20" class="icon icon--lock"
                                     viewBox="0 0 17 17" style="width:18px;height:18px;">
                                    <path d="M2.5 7V15H14.5V7H2.5Z" stroke="currentColor" stroke-width="1.5"
                                          fill="none"></path>
                                    <path d="M5.5 4C5.5 2.34315 6.84315 1 8.5 1V1C10.1569 1 11.5 2.34315 11.5 4V7H5.5V4Z"
                                          stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                          stroke-linejoin="round" fill="none"></path>
                                    <circle cx="8.5" cy="11" r="0.5" stroke="currentColor"></circle>
                                </svg>
                            </span>
                            {{ 'cart.general.checkout' | t }}
                        </a>

                        <a href="/" class="button button--secondary" style="width: 100%; margin-top: 10px;text-transform:uppercase;">
                            <span class="checkout-button__lock" style="position:absolute;
                                    line-height: 24px;top:50%;margin-top:-12px;left: 20px;">
                                <svg focusable="false" width="8" height="12" class="icon icon--chevron-back"
                                     viewBox="0 0 8 12"
                                     style="width:18px;height:18px;">
                                    <path fill="none" d="M7 1L2 6L7 11" stroke="currentColor"
                                          stroke-width="1.3"></path>
                                </svg>
                            </span>
                            {{ 'cart.general.keep_buying' | t }}
                        </a>
                    </div>

                    {%- if settings.hide_express_checkout_buttons -%}
                        {%- if additional_checkout_buttons -%}
                            <div class="additional-checkout-buttons" style="display: none !important">
                                {{ content_for_additional_checkout_buttons }}
                            </div>
                        {%- endif -%}
                    {%- endif -%}
                </div>
            {%- endif -%}
        </div>
    </form>

    {% assign back = settings.upsellsBack %}
    {% assign upsells = settings.upsells %}
    {% assign color = settings.upsellsColor %}

    <div id="upsellItems">
        <span class="drawer__overlay2" id="overlay2" style="display:none"></span>
        {% if upsells != blank %}
            {% for product in upsells.products %}
                {% if product.available %}
                    <div class="upsellItem upsell{{ product.id }}"
                         style="display:none;background:{{ back }};color:{{ color }}">
                        {% render 'productOptions', product: product %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
</div>